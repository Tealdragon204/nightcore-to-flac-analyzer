# ============================================================
# Nightcore Audio Analysis Tool — Conda Environment
# ============================================================
# Recommended approach for Arch-derivative Linux systems where
# getting CUDA libraries on PATH can be fragile with plain pip.
#
# Create environment:
#   conda env create -f environment.yml
#
# Activate:
#   conda activate nightcore-analyzer
#
# Install CREPE (requires --no-build-isolation due to legacy setup.py):
#   pip install --no-build-isolation crepe
#
# Verify:
#   python verify_cuda.py
#
# Remove environment (uninstall):
#   conda deactivate
#   conda env remove -n nightcore-analyzer
# ============================================================

name: nightcore-analyzer

channels:
  - conda-forge
  - nvidia          # provides cuda-toolkit, cudnn packages
  - defaults

dependencies:
  # Core Python runtime
  - python=3.11
  - pip
  - setuptools             # needed for CREPE's legacy setup.py (pkg_resources)

  # NumPy/SciPy pinned below 2.x for TensorFlow/librosa compatibility
  - numpy>=1.24,<2.0
  - scipy>=1.11

  # Visualisation
  - matplotlib>=3.8.0

  # Progress bars
  - tqdm>=4.66.0

  # Everything else via pip — avoids conda-forge package name ambiguity
  # for audio libs and pip-only packages
  - pip:
    # TensorFlow with bundled CUDA wheels
    - "tensorflow[and-cuda]>=2.15.0,<2.17.0"

    # NOTE: CREPE is NOT listed here — it must be installed separately
    # after env creation with: pip install --no-build-isolation crepe
    # (Its legacy setup.py imports pkg_resources, which breaks pip's
    # build isolation on modern Python/setuptools.)

    # Audio I/O — pip names are unambiguous; conda-forge names vary by version
    - "librosa>=0.10.1"
    - "soundfile>=0.12.1"
    - "audioread>=3.0.0"

    # Rubber Band Python bindings
    # Requires rubberband binary: sudo pacman -S rubberband
    - "pyrubberband>=0.3.0"

    # PyQt6 — use pip; conda-forge 'pyqt' package is PyQt5, not PyQt6
    - "PyQt6>=6.6.0"

    # Fast real-time Qt plotting
    - "pyqtgraph>=0.13.4"
